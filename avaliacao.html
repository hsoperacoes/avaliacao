<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema de Avaliação de Candidatos</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;line-height:1.6;color:#eaeaea;background:#1a1a1a;min-height:100vh;padding:20px 0}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}

    .form-header{background:linear-gradient(135deg,#2c3e50 0%,#34495e 100%);color:#fff;padding:40px 30px;text-align:center;border-radius:15px 15px 0 0;box-shadow:0 4px 20px rgba(0,0,0,.3);position:relative;overflow:hidden}
    .form-header::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,.05) 0%,transparent 70%);animation:rotate 30s linear infinite}
    @keyframes rotate{from{transform:rotate(0)}to{transform:rotate(360deg)}}
    .header-content{position:relative;z-index:1}
    .header-icon{font-size:3em;margin-bottom:20px;color:#4CAF50}
    .form-header h1{font-size:2.2em;font-weight:700;margin-bottom:10px}
    .form-header h2{font-size:1.4em;font-weight:400;margin-bottom:15px;color:#ecf0f1}
    .form-header p{font-size:1.05em;opacity:.9;max-width:680px;margin:0 auto}

    .form-container{background:#2a2a2a;border-radius:0 0 15px 15px;box-shadow:0 4px 20px rgba(0,0,0,.3);padding:30px}

    .form-block{background:#3a3a3a;border-radius:12px;margin-bottom:25px;box-shadow:0 4px 15px rgba(0,0,0,.2);border-left:4px solid #4CAF50;animation:slideInUp .6s ease-out forwards;opacity:0;transform:translateY(30px)}
    .form-block:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.3)}
    .block-header{background:linear-gradient(135deg,#4CAF50 0%,#45a049 100%);color:#fff;padding:18px 22px;border-radius:8px 8px 0 0;display:flex;gap:12px;align-items:center}
    .block-header i{font-size:1.3em}
    .block-header h3{font-size:1.15em;font-weight:700;margin:0}
    .block-content{padding:22px}

    .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:18px}
    .form-group{display:flex;flex-direction:column}
    .form-group.full-width{grid-column:1 / -1}

    label{color:#e0e0e0;font-weight:600;margin-bottom:8px;font-size:.95em}
    input[type="text"],input[type="email"],input[type="tel"],input[type="date"],input[type="number"],textarea,select{
      background:#4a4a4a;border:2px solid #555;border-radius:8px;padding:12px 14px;color:#e0e0e0;font-size:1em;transition:all .25s ease}
    textarea{min-height:100px;resize:vertical}
    input:focus,textarea:focus,select:focus{outline:none;border-color:#4CAF50;box-shadow:0 0 0 3px rgba(76,175,80,.2);background:#5a5a5a}
    input::placeholder,textarea::placeholder{color:#bdbdbd}

    .radio-group{display:flex;gap:14px;flex-wrap:wrap;margin-top:10px}
    .radio-option{display:flex;align-items:center;gap:10px;cursor:pointer;padding:10px 14px;border-radius:8px;background:#4a4a4a;border:2px solid #555;color:#e0e0e0;font-weight:500}
    .radio-option:hover{background:#5a5a5a;border-color:#4CAF50}
    .radio-option input{display:none}
    .radio-custom{width:20px;height:20px;border:2px solid #777;border-radius:50%;position:relative;transition:.25s}
    .radio-option input:checked + .radio-custom{border-color:#4CAF50;background:#4CAF50}
    .radio-option input:checked + .radio-custom::after{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:8px;height:8px;background:#fff;border-radius:50%}
    .radio-option input:checked ~ span:not(.radio-custom){color:#4CAF50}

    .question-section{background:#444;border-radius:10px;padding:16px 16px 18px;margin-bottom:14px;border:1px solid #555}
    .qs-title{color:#b7ffbf;font-weight:700;margin-bottom:8px}
    .qs-sub{color:#d9d9d9;margin:8px 0 4px;font-size:.95em}

    /* Situação alinhada: coluna fixa para o rótulo + textarea ocupando o restante */
    .textarea-grid{display:grid;grid-template-columns:110px 1fr;gap:12px;align-items:flex-start;margin-top:8px}
    .textarea-grid .field-label{color:#e0e0e0;font-weight:700;margin-top:6px}
    .textarea-grid textarea{width:100%;min-height:120px}
    .options-indent{margin-left:110px}

    /* Botões */
    .form-actions{display:flex;gap:18px;justify-content:center;margin-top:28px;padding-top:18px;border-top:2px solid #555}
    .btn{appearance:none;-webkit-appearance:none;border:0;cursor:pointer;display:inline-flex;align-items:center;gap:10px;padding:12px 22px;border-radius:10px;font-weight:700;letter-spacing:.3px;text-decoration:none;font-size:1rem;box-shadow:0 4px 15px rgba(0,0,0,.2);transition:.2s}
    .btn i{font-size:.95rem}
    .btn--primary{background:linear-gradient(135deg,#4CAF50 0%,#45a049 100%);color:#fff}
    .btn--secondary{background:linear-gradient(135deg,#2196F3 0%,#1976D2 100%);color:#fff}
    .btn:hover{transform:translateY(-1px);box-shadow:0 8px 20px rgba(0,0,0,.3)}

    .success-message{background:linear-gradient(135deg,#4CAF50 0%,#45a049 100%);color:#fff;padding:16px;border-radius:8px;text-align:center;margin:10px 0;display:none}
    .loading{display:none;text-align:center;padding:16px;color:#4CAF50}
    .loading i{animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    @keyframes slideInUp{to{opacity:1;transform:translateY(0)}}

    @media (max-width:768px){
      .form-grid{grid-template-columns:1fr}
      .textarea-grid{grid-template-columns:1fr;gap:6px}
      .options-indent{margin-left:0}
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="form-header">
      <div class="header-content">
        <i class="fas fa-user-tie header-icon"></i>
        <h1>AVALIAÇÃO DE CANDIDATO</h1>
        <h2>Sistema de Gestão de Recursos Humanos</h2>
        <p>Preencha as informações do candidato para análise e processo seletivo</p>
      </div>
    </header>

    <div class="form-container">
      <div class="success-message" id="successMessage"><i class="fas fa-check-circle"></i> Avaliação enviada!</div>
      <div class="loading" id="loadingMessage"><i class="fas fa-spinner"></i> Enviando dados...</div>

      <form id="candidateForm">
        <!-- 1. Dados Pessoais -->
        <div class="form-block">
          <div class="block-header"><i class="fas fa-user"></i><h3>Dados Pessoais do Candidato</h3></div>
          <div class="block-content">
            <div class="form-grid">
              <div class="form-group full-width">
                <label for="nome">Nome Completo *</label>
                <input type="text" id="nome" name="nome" required>
              </div>
              <div class="form-group">
                <label for="idade">Idade *</label>
                <input type="number" id="idade" name="idade" min="16" max="80" required>
              </div>
              <div class="form-group">
                <label for="telefone">Telefone *</label>
                <input type="tel" id="telefone" name="telefone" required>
              </div>
              <div class="form-group full-width">
                <label for="email">E-mail *</label>
                <input type="email" id="email" name="email" required>
              </div>
            </div>
          </div>
        </div>

        <!-- 2º Passo – Avaliando as Competências -->
        <div class="form-block">
          <div class="block-header"><i class="fas fa-clipboard-check"></i><h3>2º Passo – Avaliando as Competências</h3></div>
          <div class="block-content">

            <div class="question-section">
              <div class="qs-title">FOCO EM RESULTADO — Conte-me sobre algum resultado inesperado, onde você tenha ultrapassado as expectativas ou metas.</div>
              <div class="textarea-grid">
                <div class="field-label">Situação</div>
                <textarea id="foco_resultado_text" name="foco_resultado_text" placeholder="Descreva a situação relatada pelo candidato..."></textarea>
              </div>
              <div class="qs-sub">A situação apresentada evidenciou a competência?</div>
              <div class="radio-group options-indent">
                <label class="radio-option"><input type="radio" name="foco_resultado_comp" value="sim"><span class="radio-custom"></span>Sim</label>
                <label class="radio-option"><input type="radio" name="foco_resultado_comp" value="nao"><span class="radio-custom"></span>Não</label>
                <label class="radio-option"><input type="radio" name="foco_resultado_comp" value="em_parte"><span class="radio-custom"></span>Em parte</label>
              </div>
            </div>

            <div class="question-section">
              <div class="qs-title">RELACIONAMENTO — Conte-me uma situação onde teve um desentendimento com um colega de trabalho e como foi resolvido.</div>
              <div class="textarea-grid">
                <div class="field-label">Situação</div>
                <textarea id="relacionamento_text" name="relacionamento_text" placeholder="Descreva a situação relatada pelo candidato..."></textarea>
              </div>
              <div class="qs-sub">Evidenciou a competência?</div>
              <div class="radio-group options-indent">
                <label class="radio-option"><input type="radio" name="relacionamento_comp" value="sim"><span class="radio-custom"></span>Sim</label>
                <label class="radio-option"><input type="radio" name="relacionamento_comp" value="nao"><span class="radio-custom"></span>Não</label>
                <label class="radio-option"><input type="radio" name="relacionamento_comp" value="em_parte"><span class="radio-custom"></span>Em parte</label>
              </div>
            </div>

            <div class="question-section">
              <div class="qs-title">ATITUDE — Conte-me uma situação onde você trouxe uma ideia para melhorar o resultado da equipe ou do setor.</div>
              <div class="textarea-grid">
                <div class="field-label">Situação</div>
                <textarea id="atitude_text" name="atitude_text" placeholder="Descreva a situação relatada pelo candidato..."></textarea>
              </div>
              <div class="qs-sub">Evidenciou a competência?</div>
              <div class="radio-group options-indent">
                <label class="radio-option"><input type="radio" name="atitude_comp" value="sim"><span class="radio-custom"></span>Sim</label>
                <label class="radio-option"><input type="radio" name="atitude_comp" value="nao"><span class="radio-custom"></span>Não</label>
                <label class="radio-option"><input type="radio" name="atitude_comp" value="em_parte"><span class="radio-custom"></span>Em parte</label>
              </div>
            </div>

            <div class="question-section">
              <div class="qs-title">COMUNICAÇÃO — Conte-me uma situação em que algo que você disse foi interpretado de maneira equivocada pelos colegas ou pelo gestor.</div>
              <div class="textarea-grid">
                <div class="field-label">Situação</div>
                <textarea id="comunicacao_text" name="comunicacao_text" placeholder="Descreva a situação relatada pelo candidato..."></textarea>
              </div>
              <div class="qs-sub">Evidenciou a competência?</div>
              <div class="radio-group options-indent">
                <label class="radio-option"><input type="radio" name="comunicacao_comp" value="sim"><span class="radio-custom"></span>Sim</label>
                <label class="radio-option"><input type="radio" name="comunicacao_comp" value="nao"><span class="radio-custom"></span>Não</label>
                <label class="radio-option"><input type="radio" name="comunicacao_comp" value="em_parte"><span class="radio-custom"></span>Em parte</label>
              </div>
            </div>

          </div>
        </div>

        <!-- Competências Específicas -->
        <div class="form-block">
          <div class="block-header"><i class="fas fa-layer-group"></i><h3>Competências Específicas</h3></div>
          <div class="block-content">

            <div class="question-section">
              <div class="qs-title">DOMÍNIO TÉCNICO — Situação em que o conhecimento técnico fez a diferença.</div>
              <div class="textarea-grid">
                <div class="field-label">Situação</div>
                <textarea id="dominio_tecnico_text" name="dominio_tecnico_text" placeholder="Descreva a situação relatada pelo candidato..."></textarea>
              </div>
              <div class="qs-sub">Evidenciou a competência?</div>
              <div class="radio-group options-indent">
                <label class="radio-option"><input type="radio" name="dominio_tecnico_comp" value="sim"><span class="radio-custom"></span>Sim</label>
                <label class="radio-option"><input type="radio" name="dominio_tecnico_comp" value="nao"><span class="radio-custom"></span>Não</label>
                <label class="radio-option"><input type="radio" name="dominio_tecnico_comp" value="em_parte"><span class="radio-custom"></span>Em parte</label>
              </div>
            </div>

            <div class="question-section">
              <div class="qs-title">TRABALHO EM EQUIPE — Situação em que não gostava de um colega e como fez para trabalhar junto.</div>
              <div class="textarea-grid">
                <div class="field-label">Situação</div>
                <textarea id="trabalho_equipe_text" name="trabalho_equipe_text" placeholder="Descreva a situação relatada pelo candidato..."></textarea>
              </div>
              <div class="qs-sub">Evidenciou a competência?</div>
              <div class="radio-group options-indent">
                <label class="radio-option"><input type="radio" name="trabalho_equipe_comp" value="sim"><span class="radio-custom"></span>Sim</label>
                <label class="radio-option"><input type="radio" name="trabalho_equipe_comp" value="nao"><span class="radio-custom"></span>Não</label>
                <label class="radio-option"><input type="radio" name="trabalho_equipe_comp" value="em_parte"><span class="radio-custom"></span>Em parte</label>
              </div>
            </div>

            <div class="question-section">
              <div class="qs-title">SOLUÇÃO DE PROBLEMAS — Situação em que encontrou um espaço desorganizado e como fez para organizar.</div>
              <div class="textarea-grid">
                <div class="field-label">Situação</div>
                <textarea id="solucao_problemas_text" name="solucao_problemas_text" placeholder="Descreva a situação relatada pelo candidato..."></textarea>
              </div>
              <div class="qs-sub">Evidenciou a competência?</div>
              <div class="radio-group options-indent">
                <label class="radio-option"><input type="radio" name="solucao_problemas_comp" value="sim"><span class="radio-custom"></span>Sim</label>
                <label class="radio-option"><input type="radio" name="solucao_problemas_comp" value="nao"><span class="radio-custom"></span>Não</label>
                <label class="radio-option"><input type="radio" name="solucao_problemas_comp" value="em_parte"><span class="radio-custom"></span>Em parte</label>
              </div>
            </div>

            <div class="form-grid">
              <div class="form-group full-width">
                <label for="pontos_fortes">Pontos Fortes</label>
                <textarea id="pontos_fortes" name="pontos_fortes" placeholder="Anote os pontos fortes do candidato..."></textarea>
              </div>
              <div class="form-group full-width">
                <label for="pontos_desenvolver">Pontos a Desenvolver</label>
                <textarea id="pontos_desenvolver" name="pontos_desenvolver" placeholder="Anote os pontos a desenvolver..."></textarea>
              </div>
              <div class="form-group full-width">
                <label for="consideracoes">Considerações</label>
                <textarea id="consideracoes" name="consideracoes" placeholder="Observações do avaliador..."></textarea>
              </div>
            </div>

          </div>
        </div>

        <!-- Avaliação Geral -->
        <div class="form-block">
          <div class="block-header"><i class="fas fa-star"></i><h3>Avaliação Geral</h3></div>
          <div class="block-content">
            <div class="form-grid">
              <div class="form-group full-width">
                <label>O candidato está apto para a vaga? *</label>
                <div class="radio-group">
                  <label class="radio-option"><input type="radio" name="apto_vaga" value="sim" required><span class="radio-custom"></span>Sim</label>
                  <label class="radio-option"><input type="radio" name="apto_vaga" value="nao" required><span class="radio-custom"></span>Não</label>
                  <label class="radio-option"><input type="radio" name="apto_vaga" value="em_parte" required><span class="radio-custom"></span>Em parte</label>
                </div>
              </div>
              <div class="form-group full-width">
                <label for="observacoes_gerais">Observações gerais</label>
                <textarea id="observacoes_gerais" name="observacoes_gerais" placeholder="Adicione observações importantes sobre o candidato..."></textarea>
              </div>
            </div>
          </div>
        </div>

        <!-- Avaliador -->
        <div class="form-block">
          <div class="block-header"><i class="fas fa-user-check"></i><h3>Dados do Avaliador</h3></div>
          <div class="block-content">
            <div class="form-grid">
              <div class="form-group">
                <label for="nome_avaliador">Nome do Avaliador *</label>
                <input type="text" id="nome_avaliador" name="nome_avaliador" required>
              </div>
              <div class="form-group">
                <label for="cargo_avaliador">Cargo *</label>
                <input type="text" id="cargo_avaliador" name="cargo_avaliador" required>
              </div>
              <div class="form-group full-width">
                <label for="data_avaliacao">Data da Avaliação *</label>
                <input type="date" id="data_avaliacao" name="data_avaliacao" required>
              </div>
            </div>
          </div>
        </div>

        <!-- Ações -->
        <div class="form-actions">
          <button type="submit" class="btn btn--primary"><i class="fas fa-paper-plane"></i> Enviar Avaliação</button>
          <button type="reset" class="btn btn--secondary" style="background:linear-gradient(135deg,#f44336 0%,#d32f2f 100%)"><i class="fas fa-eraser"></i> Limpar Formulário</button>
        </div>

        <!-- Navegação -->
        <div class="form-actions" style="margin-top: 18px;">
          <a href="../home.html" class="btn btn--primary"><i class="fas fa-home"></i> Voltar ao Home</a>
          <a href="../funcionarios.html" class="btn btn--secondary"><i class="fas fa-users"></i> Lista de Funcionários</a>
        </div>
      </form>
    </div>
  </div>

  <script>
    /* URL do seu Web App (GAS) */
    const GAS_EVAL_URL = 'https://script.google.com/macros/s/AKfycbzx7fZB5WPpdAI7nUADWhzWZF83CyTKIl50jkOeJanoPao9t1eecOQ5CrshZksO5A5e/exec';

    document.addEventListener('DOMContentLoaded', () => {
      const today = new Date().toISOString().split('T')[0];
      const el = document.getElementById('data_avaliacao');
      if (el) el.value = today;
    });

    function scrollToFirstInvalid(form){
      const firstInvalid = form.querySelector('input:invalid, select:invalid, textarea:invalid');
      if (firstInvalid){
        firstInvalid.scrollIntoView({behavior:'smooth', block:'center'});
        firstInvalid.reportValidity();
      }
    }

    async function sendViaGAS(formObj){
      try{
        await fetch(GAS_EVAL_URL,{
          method:'POST',
          mode:'no-cors',
          headers:{'Content-Type':'text/plain'},
          body:JSON.stringify({ type:'candidate_evaluation', ...formObj })
        });
        return true;
      }catch(err){
        console.error('Falha ao enviar para GAS:',err);
        return false;
      }
    }

    function saveEvaluation(data){
      const evaluations = JSON.parse(localStorage.getItem('evaluations')||'[]');
      evaluations.push({ id:Date.now().toString(), ...data, timestamp:new Date().toISOString() });
      localStorage.setItem('evaluations', JSON.stringify(evaluations));
    }

    function addApprovedCandidateToEmployees(data){
      const employees = JSON.parse(localStorage.getItem('employees')||'[]');
      const exists = employees.some(e => e.name===data.nome && e.email===data.email);
      if (exists){ alert('Este candidato já está na lista de funcionários.'); return; }

      const newEmployee = {
        id: Date.now().toString(),
        name: data.nome,
        position: 'A definir',
        startDate: new Date().toISOString().split('T')[0],
        manager: data.nome_avaliador,
        email: data.email,
        status: 'pending',
        progress: 0,
        onboardingData: { completedTasks: [], lastUpdate: new Date().toISOString() },
        evaluationData: data
      };
      employees.push(newEmployee);
      localStorage.setItem('employees', JSON.stringify(employees));
      alert(`${data.nome} foi adicionado à lista de funcionários!`);
    }

    document.getElementById('candidateForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const form = e.target;
      if (!form.checkValidity()){ scrollToFirstInvalid(form); return; }

      const loading = document.getElementById('loadingMessage');
      const success = document.getElementById('successMessage');

      loading.style.display='block';

      const fd = new FormData(form);
      const data = {};
      for (const [k,v] of fd.entries()) data[k]=v;

      try{
        await sendViaGAS(data);   // sempre envia para o GAS
        saveEvaluation(data);     // guarda local
        if (data.apto_vaga==='sim') addApprovedCandidateToEmployees(data); // apto => vira funcionário

        loading.style.display='none';
        success.style.display='block';
        setTimeout(()=>{
          form.reset();
          success.style.display='none';
          const today = new Date().toISOString().split('T')[0];
          const el = document.getElementById('data_avaliacao'); if (el) el.value = today;
        },2200);
      }catch(err){
        loading.style.display='none';
        console.error(err);
        alert('Erro ao enviar avaliação. Tente novamente.');
      }
    });

    document.querySelectorAll('.form-block').forEach((b,i)=>b.style.animationDelay=`${i*0.1}s`);
  </script>
</body>
</html>
