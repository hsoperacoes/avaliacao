<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema de Avaliação de Candidatos</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
  <style>
    /* ===== Reset & base ===== */
    * { margin:0; padding:0; box-sizing:border-box }
    body{ font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height:1.6; color:#eaeaea; background:#1a1a1a; min-height:100vh; padding:20px 0 }
    .container{ max-width:1200px; margin:0 auto; padding:0 20px }

    /* ===== Header ===== */
    .form-header{ background:linear-gradient(135deg,#2c3e50,#34495e); color:#fff; padding:40px 30px; text-align:center; border-radius:15px 15px 0 0; box-shadow:0 4px 20px rgba(0,0,0,.3); position:relative; overflow:hidden }
    .form-header::before{ content:''; position:absolute; top:-50%; left:-50%; width:200%; height:200%; background:radial-gradient(circle,rgba(255,255,255,.06) 0%, transparent 70%); animation:rotate 30s linear infinite }
    @keyframes rotate{ from{transform:rotate(0)} to{transform:rotate(360deg)} }
    .header-content{ position:relative; z-index:1 }
    .header-icon{ font-size:3em; margin-bottom:16px; color:#4CAF50 }
    .form-header h1{ font-size:2.2em; font-weight:700; margin-bottom:6px }
    .form-header h2{ font-size:1.2em; font-weight:500; opacity:.9 }

    /* ===== Card/blocks ===== */
    .form-container{ background:#2a2a2a; border-radius:0 0 15px 15px; box-shadow:0 4px 20px rgba(0,0,0,.3); padding:28px }
    .form-block{ background:#3a3a3a; border-radius:12px; margin-bottom:22px; box-shadow:0 4px 15px rgba(0,0,0,.2); border-left:4px solid #4CAF50 }
    .block-header{ background:linear-gradient(135deg,#4CAF50,#45a049); color:#fff; padding:16px 22px; border-radius:8px 8px 0 0; display:flex; align-items:center; gap:12px }
    .block-header i{ font-size:1.2em } .block-header h3{ font-size:1.12em; font-weight:700; margin:0 }
    .block-content{ padding:22px }

    /* ===== Grid ===== */
    .form-grid{ display:grid; grid-template-columns:repeat(12,1fr); gap:16px; align-items:start }
    .col-12{ grid-column: span 12 } .col-6{ grid-column: span 6 } .col-4{ grid-column: span 4 } .col-3{ grid-column: span 3 }

    /* ===== Inputs ===== */
    label{ color:#e6e6e6; font-weight:600; margin-bottom:6px; display:block }
    input[type="text"],input[type="email"],input[type="tel"],input[type="date"],input[type="number"],textarea,select{
      width:100%; background:#4a4a4a; border:2px solid #555; border-radius:10px; padding:12px 14px; color:#eaeaea; font-size:1rem; transition:.2s ease; display:block
    }
    textarea{ min-height:92px; resize:vertical }
    input:focus,textarea:focus,select:focus{ outline:none; border-color:#4CAF50; box-shadow:0 0 0 3px rgba(76,175,80,.2); background:#565656 }
    ::placeholder{ color:#bdbdbd }

    /* ===== Rating (estrelas) ===== */
    .q-block{ background:#444; border:2px solid #555; border-radius:12px; padding:16px; margin-bottom:14px }
    .q-title{ font-weight:700; color:#a5e8b1; margin-bottom:10px }
    .rating-row{ display:flex; align-items:center; gap:14px; flex-wrap:wrap }
    .stars{ display:inline-flex; flex-direction:row-reverse; gap:4px }
    .stars input{ display:none }
    .stars label{ font-size:28px; line-height:1; color:#757575; cursor:pointer; user-select:none }
    /* hover e marcado: pinta até a esquerda */
    .stars label:hover, .stars label:hover ~ label, .stars input:checked ~ label{ color:#ffd54f }
    .legend{ font-size:.92rem; color:#d8d8d8 }

    /* ===== Ações ===== */
    .actions{ display:flex; gap:14px; justify-content:center; margin-top:26px; padding-top:22px; border-top:2px solid #555 }
    .btn{ display:inline-flex; align-items:center; gap:10px; padding:13px 22px; border:none; border-radius:10px; font-size:1rem; font-weight:800; cursor:pointer; text-transform:uppercase; letter-spacing:.5px }
    .btn-primary{ background:linear-gradient(135deg,#4CAF50,#45a049); color:#fff }
    .btn-danger{ background:linear-gradient(135deg,#f44336,#d32f2f); color:#fff }
    .btn-link{ background:transparent; color:#90caf9; border:2px solid #90caf9 }

    .success{ display:none; background:#2e7d32; color:#fff; border-radius:10px; padding:16px; text-align:center; margin-bottom:18px }
    .loading{ display:none; color:#4CAF50; text-align:center; margin-bottom:12px }

    @media(max-width:800px){
      .col-6{ grid-column: span 12 } .col-4{ grid-column: span 12 } .col-3{ grid-column: span 6 }
    }
  </style>
</head>
<body>
<div class="container">
  <header class="form-header">
    <div class="header-content">
      <i class="fas fa-user-tie header-icon"></i>
      <h1>AVALIAÇÃO DE CANDIDATO</h1>
      <h2>Sistema de Gestão de Recursos Humanos</h2>
      <p>Preencha as informações do candidato para análise e processo seletivo</p>
    </div>
  </header>

  <div class="form-container">
    <div id="okMsg" class="success"><i class="fas fa-check-circle"></i> Avaliação enviada!</div>
    <div id="loading" class="loading"><i class="fas fa-spinner fa-spin"></i> Enviando...</div>

    <form id="candidateForm">
      <!-- 1. Dados pessoais -->
      <section class="form-block">
        <div class="block-header"><i class="fas fa-user"></i><h3>Dados Pessoais do Candidato</h3></div>
        <div class="block-content">
          <div class="form-grid">
            <div class="col-12">
              <label for="nome">Nome Completo *</label>
              <input id="nome" name="nome" type="text" required/>
            </div>
            <div class="col-3">
              <label for="idade">Idade</label>
              <input id="idade" name="idade" type="number" min="14" max="90" placeholder="ex.: 28"/>
            </div>
            <div class="col-3">
              <label for="telefone">Telefone</label>
              <input id="telefone" name="telefone" type="tel" placeholder="(xx) xxxxx-xxxx"/>
            </div>
            <div class="col-3">
              <label for="email">E-mail</label>
              <input id="email" name="email" type="email" placeholder="email@dominio.com"/>
            </div>
            <div class="col-3">
              <label for="funcao_prevista">Função pretendida *</label>
              <input id="funcao_prevista" name="funcao_prevista" type="text" required placeholder="ex.: Vendedor, Caixa, Estoquista"/>
            </div>
          </div>
        </div>
      </section>

      <!-- 2. Competências (estrelas) -->
      <section class="form-block">
        <div class="block-header"><i class="fas fa-clipboard-check"></i><h3>2º Passo — Avaliando as Competências</h3></div>
        <div class="block-content">
          <div class="q-block">
            <div class="q-title">FOCO EM RESULTADO — Resultado além da meta.</div>
            <div class="rating-row">
              <div class="stars" role="radiogroup" aria-label="Foco em Resultado">
                <input id="foco5" type="radio" name="foco_resultado_score" value="5" required><label for="foco5" title="5 estrelas">★</label>
                <input id="foco4" type="radio" name="foco_resultado_score" value="4"><label for="foco4" title="4 estrelas">★</label>
                <input id="foco3" type="radio" name="foco_resultado_score" value="3"><label for="foco3" title="3 estrelas">★</label>
                <input id="foco2" type="radio" name="foco_resultado_score" value="2"><label for="foco2" title="2 estrelas">★</label>
                <input id="foco1" type="radio" name="foco_resultado_score" value="1"><label for="foco1" title="1 estrela">★</label>
              </div>
              <div class="legend">1–2: Ruim • 3–4: Boa • 5: Excelente</div>
            </div>
          </div>

          <div class="q-block">
            <div class="q-title">RELACIONAMENTO — Lidar com conflito e resolver.</div>
            <div class="rating-row">
              <div class="stars" role="radiogroup" aria-label="Relacionamento">
                <input id="rel5" type="radio" name="relacionamento_score" value="5" required><label for="rel5">★</label>
                <input id="rel4" type="radio" name="relacionamento_score" value="4"><label for="rel4">★</label>
                <input id="rel3" type="radio" name="relacionamento_score" value="3"><label for="rel3">★</label>
                <input id="rel2" type="radio" name="relacionamento_score" value="2"><label for="rel2">★</label>
                <input id="rel1" type="radio" name="relacionamento_score" value="1"><label for="rel1">★</label>
              </div>
              <div class="legend">1–2: Ruim • 3–4: Boa • 5: Excelente</div>
            </div>
          </div>

          <div class="q-block">
            <div class="q-title">ATITUDE — Iniciativa para melhorar resultado da equipe.</div>
            <div class="rating-row">
              <div class="stars" role="radiogroup" aria-label="Atitude">
                <input id="ati5" type="radio" name="atitude_score" value="5" required><label for="ati5">★</label>
                <input id="ati4" type="radio" name="atitude_score" value="4"><label for="ati4">★</label>
                <input id="ati3" type="radio" name="atitude_score" value="3"><label for="ati3">★</label>
                <input id="ati2" type="radio" name="atitude_score" value="2"><label for="ati2">★</label>
                <input id="ati1" type="radio" name="atitude_score" value="1"><label for="ati1">★</label>
              </div>
              <div class="legend">1–2: Ruim • 3–4: Boa • 5: Excelente</div>
            </div>
          </div>

          <div class="q-block">
            <div class="q-title">COMUNICAÇÃO — Clareza e correção de mal-entendidos.</div>
            <div class="rating-row">
              <div class="stars" role="radiogroup" aria-label="Comunicação">
                <input id="com5" type="radio" name="comunicacao_score" value="5" required><label for="com5">★</label>
                <input id="com4" type="radio" name="comunicacao_score" value="4"><label for="com4">★</label>
                <input id="com3" type="radio" name="comunicacao_score" value="3"><label for="com3">★</label>
                <input id="com2" type="radio" name="comunicacao_score" value="2"><label for="com2">★</label>
                <input id="com1" type="radio" name="comunicacao_score" value="1"><label for="com1">★</label>
              </div>
              <div class="legend">1–2: Ruim • 3–4: Boa • 5: Excelente</div>
            </div>
          </div>
        </div>
      </section>

      <!-- 3. Competências Específicas (estrelas) -->
      <section class="form-block">
        <div class="block-header"><i class="fas fa-layer-group"></i><h3>Competências Específicas</h3></div>
        <div class="block-content">
          <div class="q-block">
            <div class="q-title">DOMÍNIO TÉCNICO — Conhecimento aplicado.</div>
            <div class="rating-row">
              <div class="stars" role="radiogroup" aria-label="Domínio Técnico">
                <input id="tec5" type="radio" name="dominio_tecnico_score" value="5" required><label for="tec5">★</label>
                <input id="tec4" type="radio" name="dominio_tecnico_score" value="4"><label for="tec4">★</label>
                <input id="tec3" type="radio" name="dominio_tecnico_score" value="3"><label for="tec3">★</label>
                <input id="tec2" type="radio" name="dominio_tecnico_score" value="2"><label for="tec2">★</label>
                <input id="tec1" type="radio" name="dominio_tecnico_score" value="1"><label for="tec1">★</label>
              </div>
              <div class="legend">1–2: Ruim • 3–4: Boa • 5: Excelente</div>
            </div>
          </div>

          <div class="q-block">
            <div class="q-title">TRABALHO EM EQUIPE — Colaboração mesmo com diferenças.</div>
            <div class="rating-row">
              <div class="stars" role="radiogroup" aria-label="Trabalho em Equipe">
                <input id="eqp5" type="radio" name="trabalho_equipe_score" value="5" required><label for="eqp5">★</label>
                <input id="eqp4" type="radio" name="trabalho_equipe_score" value="4"><label for="eqp4">★</label>
                <input id="eqp3" type="radio" name="trabalho_equipe_score" value="3"><label for="eqp3">★</label>
                <input id="eqp2" type="radio" name="trabalho_equipe_score" value="2"><label for="eqp2">★</label>
                <input id="eqp1" type="radio" name="trabalho_equipe_score" value="1"><label for="eqp1">★</label>
              </div>
              <div class="legend">1–2: Ruim • 3–4: Boa • 5: Excelente</div>
            </div>
          </div>

          <div class="q-block">
            <div class="q-title">SOLUÇÃO DE PROBLEMAS — Organização e melhoria.</div>
            <div class="rating-row">
              <div class="stars" role="radiogroup" aria-label="Solução de Problemas">
                <input id="sol5" type="radio" name="solucao_problemas_score" value="5" required><label for="sol5">★</label>
                <input id="sol4" type="radio" name="solucao_problemas_score" value="4"><label for="sol4">★</label>
                <input id="sol3" type="radio" name="solucao_problemas_score" value="3"><label for="sol3">★</label>
                <input id="sol2" type="radio" name="solucao_problemas_score" value="2"><label for="sol2">★</label>
                <input id="sol1" type="radio" name="solucao_problemas_score" value="1"><label for="sol1">★</label>
              </div>
              <div class="legend">1–2: Ruim • 3–4: Boa • 5: Excelente</div>
            </div>
          </div>
        </div>
      </section>

      <!-- 4. Pontos & considerações -->
      <section class="form-block">
        <div class="block-header"><i class="fas fa-comment-dots"></i><h3>Pontos & Considerações</h3></div>
        <div class="block-content">
          <div class="form-grid">
            <div class="col-6">
              <label for="pontos_fortes">Pontos Fortes</label>
              <textarea id="pontos_fortes" name="pontos_fortes" placeholder="Destaques positivos do candidato..."></textarea>
            </div>
            <div class="col-6">
              <label for="pontos_desenvolver">Pontos a Desenvolver</label>
              <textarea id="pontos_desenvolver" name="pontos_desenvolver" placeholder="Aspectos que precisam evoluir..."></textarea>
            </div>
            <div class="col-12">
              <label for="consideracoes">Considerações</label>
              <textarea id="consideracoes" name="consideracoes" placeholder="Observações adicionais..."></textarea>
            </div>
          </div>
        </div>
      </section>

      <!-- 5. Escolaridade (igual) -->
      <section class="form-block">
        <div class="block-header"><i class="fas fa-user-graduate"></i><h3>3º Passo — Escolaridade</h3></div>
        <div class="block-content">
          <div class="q-block">
            <div class="q-title">Grau de Instrução</div>
            <div class="rating-row" style="gap:12px; flex-wrap:wrap">
              <label class="pill"><input type="radio" name="grau_instrucao" value="Ensino Fundamental"><span class="dot" style="display:none"></span>Ensino Fundamental</label>
              <label class="pill"><input type="radio" name="grau_instrucao" value="Ensino Médio"><span class="dot" style="display:none"></span>Ensino Médio</label>
              <label class="pill"><input type="radio" name="grau_instrucao" value="Ensino Médio Cursando ou Incompleto"><span class="dot" style="display:none"></span>Médio Cursando/Incompleto</label>
              <label class="pill"><input type="radio" name="grau_instrucao" value="Ensino Superior"><span class="dot" style="display:none"></span>Ensino Superior</label>
              <label class="pill"><input type="radio" name="grau_instrucao" value="Ensino Superior Cursando ou Incompleto"><span class="dot" style="display:none"></span>Superior Cursando/Incompleto</label>
            </div>
          </div>

          <div class="form-grid">
            <div class="col-12">
              <label>Em caso de cursos que está estudando, o candidato:</label>
              <div class="rating-row" style="gap:12px; flex-wrap:wrap">
                <label class="pill"><input type="radio" name="curso_estado" value="Já está realizando"><span class="dot" style="display:none"></span>Já está realizando</label>
                <label class="pill"><input type="radio" name="curso_estado" value="Ainda irá realizar"><span class="dot" style="display:none"></span>Ainda irá realizar</label>
                <label class="pill"><input type="radio" name="curso_estado" value="Não é obrigatório"><span class="dot" style="display:none"></span>Não é obrigatório</label>
              </div>
            </div>
            <div class="col-6">
              <label for="curso_escolhido">Em caso de curso superior: Curso escolhido</label>
              <input id="curso_escolhido" name="curso_escolhido" type="text" />
            </div>
            <div class="col-6">
              <label for="curso_motivo">Por que escolheu o curso?</label>
              <input id="curso_motivo" name="curso_motivo" type="text" />
            </div>
            <div class="col-12">
              <label>Pretende seguir carreira na área?</label>
              <div class="rating-row" style="gap:12px; flex-wrap:wrap">
                <label class="pill"><input type="radio" name="carreira_area" value="Sim"><span class="dot" style="display:none"></span>Sim</label>
                <label class="pill"><input type="radio" name="carreira_area" value="Não"><span class="dot" style="display:none"></span>Não</label>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 6. Aspectos pessoais e familiares (igual) -->
      <section class="form-block">
        <div class="block-header"><i class="fas fa-people-roof"></i><h3>4º Passo — Aspectos Pessoais e Familiares</h3></div>
        <div class="block-content">
          <!-- (mantido igual ao seu) -->
          <div class="form-grid">
            <div class="col-12">
              <label>Mora com:</label>
              <div class="rating-row" style="gap:12px; flex-wrap:wrap">
                <label class="pill"><input type="radio" name="mora_com" value="Pais"><span class="dot" style="display:none"></span>Pais</label>
                <label class="pill"><input type="radio" name="mora_com" value="Marido/Esposa"><span class="dot" style="display:none"></span>Marido/Esposa</label>
                <label class="pill"><input type="radio" name="mora_com" value="Sozinho"><span class="dot" style="display:none"></span>Sozinho</label>
                <label class="pill"><input type="radio" name="mora_com" value="Outros"><span class="dot" style="display:none"></span>Outros</label>
              </div>
            </div>
            <div class="col-6">
              <label for="profissao_pais">Profissão dos pais</label>
              <input id="profissao_pais" name="profissao_pais" type="text"/>
            </div>
            <div class="col-6">
              <label for="profissao_conjuge">Do marido/esposa</label>
              <input id="profissao_conjuge" name="profissao_conjuge" type="text"/>
            </div>

            <div class="col-12">
              <label>O imóvel onde mora é:</label>
              <div class="rating-row" style="gap:12px; flex-wrap:wrap">
                <label class="pill"><input type="radio" name="imovel" value="Próprio"><span class="dot" style="display:none"></span>Próprio</label>
                <label class="pill"><input type="radio" name="imovel" value="Alugado"><span class="dot" style="display:none"></span>Alugado</label>
              </div>
            </div>
            <div class="col-6">
              <label for="valor_aluguel">Se alugado, valor (R$)</label>
              <input id="valor_aluguel" name="valor_aluguel" type="text" placeholder="ex.: 750,00"/>
            </div>

            <div class="col-12">
              <label>Contribui financeiramente em casa?</label>
              <div class="rating-row" style="gap:12px; flex-wrap:wrap">
                <label class="pill"><input type="radio" name="contribui_casa" value="Não"><span class="dot" style="display:none"></span>Não</label>
                <label class="pill"><input type="radio" name="contribui_casa" value="Sim"><span class="dot" style="display:none"></span>Sim</label>
              </div>
            </div>
            <div class="col-6">
              <label for="quanto_contribui">Se sim, em quanto?</label>
              <input id="quanto_contribui" name="quanto_contribui" type="text" placeholder="ex.: 400,00"/>
            </div>

            <div class="col-4">
              <label for="maior_sonho">Qual seu maior sonho?</label>
              <input id="maior_sonho" name="maior_sonho" type="text"/>
            </div>
            <div class="col-4">
              <label for="como_se_define">Como você se define?</label>
              <input id="como_se_define" name="como_se_define" type="text"/>
            </div>
            <div class="col-4">
              <label for="espera_hering">O que espera com a Hering?</label>
              <input id="espera_hering" name="espera_hering" type="text"/>
            </div>

            <div class="col-12">
              <label for="parecer_gerente">Parecer do Gerente</label>
              <textarea id="parecer_gerente" name="parecer_gerente"></textarea>
            </div>
            <div class="col-6">
              <label for="nome_gerente">Nome do Gerente</label>
              <input id="nome_gerente" name="nome_gerente" type="text"/>
            </div>
          </div>
        </div>
      </section>

      <!-- 7. Avaliação Geral -->
      <section class="form-block">
        <div class="block-header"><i class="fas fa-star"></i><h3>Avaliação Geral</h3></div>
        <div class="block-content">
          <div class="q-block">
            <div class="rating-row" style="gap:12px; flex-wrap:wrap">
              <label>O candidato está apto para a vaga? *</label>
              <label class="pill"><input type="radio" name="apto_vaga" value="Sim" required><span class="dot" style="display:none"></span>Sim</label>
              <label class="pill"><input type="radio" name="apto_vaga" value="Não" required><span class="dot" style="display:none"></span>Não</label>
              <label class="pill"><input type="radio" name="apto_vaga" value="Em parte" required><span class="dot" style="display:none"></span>Em parte</label>
            </div>
            <div style="margin-top:12px">
              <label>Observações gerais</label>
              <textarea name="observacoes_gerais" placeholder="Anotações importantes sobre o candidato..."></textarea>
            </div>
          </div>
        </div>
      </section>

      <!-- 8. Dados do Avaliador -->
      <section class="form-block">
        <div class="block-header"><i class="fas fa-user-check"></i><h3>Dados do Avaliador</h3></div>
        <div class="block-content">
          <div class="form-grid">
            <div class="col-6">
              <label for="nome_avaliador">Nome do Avaliador *</label>
              <input id="nome_avaliador" name="nome_avaliador" type="text" required/>
            </div>
            <div class="col-6">
              <label for="cargo_avaliador">Cargo</label>
              <input id="cargo_avaliador" name="cargo_avaliador" type="text" placeholder="ex.: Gerente"/>
            </div>
            <div class="col-6">
              <label for="data_avaliacao">Data da Avaliação *</label>
              <input id="data_avaliacao" name="data_avaliacao" type="date" required/>
            </div>
          </div>
        </div>
      </section>

      <!-- Ações -->
      <div class="actions">
        <button id="submitBtn" type="submit" class="btn btn-primary"><i class="fas fa-paper-plane"></i> Enviar Avaliação</button>
        <button type="reset" class="btn btn-danger"><i class="fas fa-eraser"></i> Limpar</button>
        <a class="btn btn-link" href="/avaliacao/home.html"><i class="fas fa-home"></i> Home</a>
        <a class="btn btn-link" href="/avaliacao/funcionarios.html"><i class="fas fa-users"></i> Lista de Funcionários</a>
      </div>
    </form>
  </div>
</div>

<script>
  const EVAL_GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzx7fZB5WPpdAI7nUADWhzWZF83CyTKIl50jkOeJanoPao9t1eecOQ5CrshZksO5A5e/exec';

  document.addEventListener('DOMContentLoaded', () => {
    const today = new Date().toISOString().split('T')[0];
    const d = document.getElementById('data_avaliacao');
    if (d && !d.value) d.value = today;
  });

  function formToJSON(form){
    const fd = new FormData(form);
    const data = {};
    for (const [k,v] of fd.entries()){ data[k] = v && v.trim ? v.trim() : v; }
    return data;
  }

  async function sendToGAS(payload){
    const res = await fetch(EVAL_GAS_WEB_APP_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain' }, // seu GAS já aceita text/plain com JSON
      body: JSON.stringify(payload)
    });
    if (!res.ok) throw new Error('Falha HTTP ao enviar para o GAS');
    return res.json();
  }

  async function upsertEmployeeToSheet(data){
    const employee = {
      id: 'emp_' + Date.now(),
      name: data.nome,
      position: data.funcao_prevista || 'A definir',
      startDate: new Date().toISOString().slice(0,10),
      manager: data.nome_gerente || data.nome_avaliador || '',
      email: data.email || '',
      source: 'avaliacao.html',
      locked:'yes',          // entra bloqueado
      validatedBy:[]         // ninguém ainda
    };
    await sendToGAS({ type:'employees-upsert', employee });
    localStorage.setItem('currentEmployee', JSON.stringify({
      id: employee.id, name: employee.name, position: employee.position,
      startDate: employee.startDate, manager: employee.manager
    }));
    return employee;
  }

  function saveApprovedToLocal(data){
    const list = JSON.parse(localStorage.getItem('employees') || '[]');
    const id = 'emp_' + Date.now();
    const rec = {
      id, name: data.nome, position: data.funcao_prevista || 'A definir',
      startDate: new Date().toISOString().slice(0,10),
      manager: data.nome_avaliador || data.nome_gerente || '',
      email: data.email || '',
      status:'pending', progress:0,
      locked:'yes', validatedBy:[],
      onboardingData:{ completedTasks:[], lastUpdate:new Date().toISOString() },
      evaluationData: data
    };
    list.push(rec);
    localStorage.setItem('employees', JSON.stringify(list));
    localStorage.setItem('currentEmployee', JSON.stringify({
      id: rec.id, name: rec.name, position: rec.position, startDate: rec.startDate, manager: rec.manager
    }));
    return rec;
  }

  const form = document.getElementById('candidateForm');
  const loading = document.getElementById('loading');
  const ok = document.getElementById('okMsg');
  const submitBtn = document.getElementById('submitBtn');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    loading.style.display = 'block'; ok.style.display = 'none';
    submitBtn.disabled = true;

    const data = formToJSON(e.target);

    try{
      // 1) Envia avaliação (e-mail) pelo GAS
      await sendToGAS({ type:'candidate-eval', data });

      // 2) Se aprovado, cadastra em Employees (Sheets) — fallback local
      if (data.apto_vaga === 'Sim'){
        try{ await upsertEmployeeToSheet(data); }
        catch(upErr){ console.warn('Falha upsert Sheets; salvando local:', upErr); saveApprovedToLocal(data); }
        loading.style.display = 'none'; ok.style.display = 'block';
        setTimeout(() => { window.location.href = '/avaliacao/funcionarios.html'; }, 800);
      } else {
        loading.style.display = 'none'; ok.style.display = 'block';
        setTimeout(() => { form.reset(); ok.style.display = 'none'; }, 1500);
      }
    }catch(err){
      loading.style.display = 'none'; submitBtn.disabled = false;
      alert('Não foi possível enviar a avaliação.\n\nDetalhes: ' + err.message);
      console.error(err);
      return;
    }

    submitBtn.disabled = false;
  });
</script>
</body>
</html>
